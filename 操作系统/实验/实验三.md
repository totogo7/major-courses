# å®éªŒä¸‰ï¼šå­˜å‚¨å™¨ç®¡ç†

### ä¸€ã€å®éªŒç›®çš„

æœ¬æ¬¡å®éªŒæ—¨åœ¨é€šè¿‡ä½¿ç”¨æ“ä½œç³»ç»Ÿå†…å­˜åˆ†é…ä¿¡æ¯çš„åŠ¨æ€è§‚å¯Ÿä»¥åŠå­˜å‚¨å™¨ç®¡ç†ç®—æ³•çš„å®ç°ï¼ŒåŠ æ·±å¯¹å†…å­˜åˆ†é…åŸç†çš„ç†è§£ï¼ˆé‡ç‚¹åŠ æ·±å¯¹è¯·æ±‚å¼åˆ†é¡µå­˜å‚¨ç®¡ç†æ–¹å¼çš„ç†è§£ï¼‰ã€‚åŒæ—¶é€šè¿‡ç›¸å…³ç®—æ³•çš„å®ç°ï¼Œç†Ÿæ‚‰é¡µé¢ç½®æ¢ç®—æ³•åŠå…¶æ€§èƒ½ã€‚

### äºŒã€å®éªŒå†…å®¹

1) ä½¿ç”¨ taskmgr.exe è§‚å¯Ÿå®éªŒç¯å¢ƒä¸­çš„è¿›ç¨‹ç”Ÿå‘½å‘¨æœŸå†…ç³»ç»Ÿå†…å­˜åˆ†é…å˜åŒ–æƒ…

å†µï¼›

2) ç¼–ç¨‹å®ç°è¯·æ±‚åˆ†é¡µç®¡ç†æ–¹å¼æ—¶çš„åœ°å€å˜æ¢è¿‡ç¨‹ï¼›

3) ç¼–ç¨‹å®ç° OPT æˆ–è€… FIFO ç®—æ³•

4) ç¼–ç¨‹å®ç° LRU ç®—æ³•ï¼›

### äº”ã€æ€è€ƒé¢˜

1. OPT ç®—æ³•æ˜¯å¦å…·å¤‡å®ç”¨æ€§ï¼Ÿ

2. OPT ç®—æ³•ä¸ LRU ç®—æ³•çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ

3. è™šæ‹Ÿå­˜å‚¨å™¨çš„ä¸»è¦ç‰¹å¾æœ‰å“ªäº›ï¼Ÿ



**å®éªŒä¸‰ï¼šå­˜å‚¨å™¨ç®¡ç†**æ¶‰åŠåˆ°æ“ä½œç³»ç»Ÿå†…å­˜ç®¡ç†ä¸­åˆ†é¡µå­˜å‚¨çš„å®ç°ï¼Œç‰¹åˆ«æ˜¯é¡µé¢ç½®æ¢ç®—æ³•ã€‚ä¸‹é¢æˆ‘å°†ä¸ºæ‚¨æä¾›å®éªŒä¸­æ‰€éœ€çš„éƒ¨åˆ†ä»£ç ï¼ŒåŒ…æ‹¬åœ°å€è½¬æ¢ä»¥åŠ `FIFO` å’Œ `LRU` ç®—æ³•çš„å®ç°ã€‚ä¸ºä¿è¯ä»£ç å¯ç¼–è¯‘è¿è¡Œï¼Œæˆ‘å°†ç”¨ C++ å®ç°ã€‚ğŸ’»

---

### **ä¸€ã€åœ°å€è½¬æ¢è¿‡ç¨‹å®ç°**

è¯·æ±‚åˆ†é¡µç®¡ç†æ–¹å¼æ—¶ï¼Œéœ€è¦å°†é€»è¾‘åœ°å€è½¬æ¢ä¸ºç‰©ç†åœ°å€ã€‚é€šå¸¸æ¶‰åŠé¡µé¢å·å’Œåç§»é‡çš„è®¡ç®—ï¼š

```cpp
#include <iostream>
#include <vector>

using namespace std;

class MemoryManager {
private:
    int pageSize; // é¡µé¢å¤§å°
    vector<int> pageTable; // é¡µè¡¨

public:
    MemoryManager(int size, vector<int> table) : pageSize(size), pageTable(table) {}

    int addressTranslation(int logicalAddress) {
        int pageNumber = logicalAddress / pageSize;  // é¡µé¢å·
        int offset = logicalAddress % pageSize;      // åç§»é‡

        if (pageNumber >= pageTable.size()) {
            cout << "é”™è¯¯ï¼šé¡µå·è¶…å‡ºèŒƒå›´ï¼" << endl;
            return -1;
        }

        int physicalAddress = pageTable[pageNumber] * pageSize + offset;
        return physicalAddress;
    }
};

int main() {
    vector<int> pageTable = {2, 4, 1, 7};  // æ¨¡æ‹Ÿé¡µè¡¨
    int pageSize = 1024;                   // å‡è®¾é¡µé¢å¤§å°ä¸º1024å­—èŠ‚

    MemoryManager mm(pageSize, pageTable);
    
    int logicalAddress = 2048;  // è¾“å…¥é€»è¾‘åœ°å€
    int physicalAddress = mm.addressTranslation(logicalAddress);
    
    if (physicalAddress != -1) {
        cout << "é€»è¾‘åœ°å€ " << logicalAddress << " å¯¹åº”çš„ç‰©ç†åœ°å€æ˜¯ï¼š" << physicalAddress << endl;
    }

    return 0;
}
```

**è§£é‡Šï¼š**
1. é¡µè¡¨è®°å½•äº†æ¯ä¸ªé¡µé¢åœ¨ç‰©ç†å†…å­˜ä¸­çš„å¸§å·ã€‚
2. é€šè¿‡ `é€»è¾‘åœ°å€ / é¡µé¢å¤§å°` å¾—åˆ°é¡µé¢å·ï¼Œ`é€»è¾‘åœ°å€ % é¡µé¢å¤§å°` å¾—åˆ°åç§»é‡ã€‚
3. é¡µè¡¨è½¬æ¢åè¿”å›ç‰©ç†åœ°å€ã€‚

---

### **äºŒã€FIFO é¡µé¢ç½®æ¢ç®—æ³•**

FIFO ç®—æ³•ç®€å•æ˜“æ‡‚ï¼Œæ¯æ¬¡é¡µé¢ç½®æ¢æ—¶æ›¿æ¢æœ€æ—©è¿›å…¥çš„é¡µé¢ã€‚

```cpp
#include <iostream>
#include <queue>
#include <unordered_set>

using namespace std;

void FIFOPageReplacement(int pages[], int n, int capacity) {
    unordered_set<int> s;  // å½“å‰å†…å­˜ä¸­çš„é¡µ
    queue<int> indexes;    // FIFOé˜Ÿåˆ—
    int pageFaults = 0;    // ç¼ºé¡µæ¬¡æ•°

    for (int i = 0; i < n; i++) {
        // å¦‚æœå½“å‰é¡µä¸åœ¨å†…å­˜ä¸­
        if (s.find(pages[i]) == s.end()) {
            // å¦‚æœå†…å­˜å·²æ»¡
            if (s.size() == capacity) {
                int val = indexes.front();  // æœ€æ—©è¿›å…¥çš„é¡µé¢
                indexes.pop();
                s.erase(val);  // ä»é›†åˆä¸­åˆ é™¤
            }

            // åŠ å…¥æ–°é¡µé¢
            s.insert(pages[i]);
            indexes.push(pages[i]);

            // å¢åŠ ç¼ºé¡µæ¬¡æ•°
            pageFaults++;
        }

        cout << "è®¿é—®é¡µé¢ " << pages[i] << "ï¼Œå½“å‰å†…å­˜ï¼š";
        for (auto page : s) cout << page << " ";
        cout << endl;
    }

    cout << "æ€»ç¼ºé¡µæ¬¡æ•°ï¼š" << pageFaults << endl;
}

int main() {
    int pages[] = {1, 3, 0, 3, 5, 6, 3};  // é¡µé¢åºåˆ—
    int n = sizeof(pages) / sizeof(pages[0]);
    int capacity = 3;  // å†…å­˜å®¹é‡ä¸º 3

    FIFOPageReplacement(pages, n, capacity);
    
    return 0;
}
```

---

### **ä¸‰ã€LRU é¡µé¢ç½®æ¢ç®—æ³•**

LRUï¼ˆLeast Recently Usedï¼‰ç®—æ³•ä¼šæ›¿æ¢æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„é¡µé¢ã€‚

```cpp
#include <iostream>
#include <unordered_map>

using namespace std;

void LRUPageReplacement(int pages[], int n, int capacity) {
    unordered_map<int, int> indexes;  // è®°å½•é¡µé¢ä¸Šæ¬¡è®¿é—®æ—¶é—´
    unordered_set<int> s;             // å½“å‰å†…å­˜ä¸­çš„é¡µ
    int pageFaults = 0;               // ç¼ºé¡µæ¬¡æ•°

    for (int i = 0; i < n; i++) {
        // å¦‚æœå½“å‰é¡µä¸åœ¨å†…å­˜ä¸­
        if (s.find(pages[i]) == s.end()) {
            // å¦‚æœå†…å­˜å·²æ»¡
            if (s.size() == capacity) {
                int lru = INT_MAX, val;
                // æ‰¾åˆ°æœ€ä¹…æœªä½¿ç”¨çš„é¡µé¢
                for (auto it : s) {
                    if (indexes[it] < lru) {
                        lru = indexes[it];
                        val = it;
                    }
                }

                // æ›¿æ¢æœ€ä¹…æœªä½¿ç”¨çš„é¡µé¢
                s.erase(val);
            }

            // åŠ å…¥æ–°é¡µé¢
            s.insert(pages[i]);

            // å¢åŠ ç¼ºé¡µæ¬¡æ•°
            pageFaults++;
        }

        // æ›´æ–°å½“å‰é¡µé¢çš„è®¿é—®æ—¶é—´
        indexes[pages[i]] = i;

        cout << "è®¿é—®é¡µé¢ " << pages[i] << "ï¼Œå½“å‰å†…å­˜ï¼š";
        for (auto page : s) cout << page << " ";
        cout << endl;
    }

    cout << "æ€»ç¼ºé¡µæ¬¡æ•°ï¼š" << pageFaults << endl;
}

int main() {
    int pages[] = {1, 3, 0, 3, 5, 6, 3};  // é¡µé¢åºåˆ—
    int n = sizeof(pages) / sizeof(pages[0]);
    int capacity = 3;  // å†…å­˜å®¹é‡ä¸º 3

    LRUPageReplacement(pages, n, capacity);

    return 0;
}
```

---

### **äº”ã€æ€è€ƒé¢˜è§£ç­”**

1. **OPT ç®—æ³•æ˜¯å¦å…·å¤‡å®ç”¨æ€§ï¼Ÿ**
   - **OPTï¼ˆOptimalï¼‰ç®—æ³•**ç†è®ºä¸Šæ˜¯æœ€ä¼˜çš„ï¼Œå› ä¸ºå®ƒæ€»æ˜¯æ·˜æ±°æœªæ¥æœ€æ™šè¢«è®¿é—®çš„é¡µé¢ã€‚ç„¶è€Œåœ¨å®é™…ç³»ç»Ÿä¸­æ— æ³•é¢„çŸ¥æœªæ¥ï¼Œå› æ­¤ OPT ç®—æ³•ä¸å…·å¤‡å®ç”¨æ€§ã€‚

2. **OPT ç®—æ³•ä¸ LRU ç®—æ³•çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ**
   - **OPT ç®—æ³•**æ ¹æ®æœªæ¥çš„é¡µé¢è®¿é—®æƒ…å†µè¿›è¡Œé¡µé¢æ›¿æ¢ï¼Œè€Œ**LRU ç®—æ³•**æ ¹æ®è¿‡å»çš„é¡µé¢è®¿é—®è®°å½•æ¥è¿›è¡Œæ›¿æ¢ã€‚OPT æ˜¯ç†æƒ³çŠ¶æ€ï¼Œè€Œ LRU æ˜¯å¯å®ç°çš„è¿‘ä¼¼æ–¹æ¡ˆã€‚

3. **è™šæ‹Ÿå­˜å‚¨å™¨çš„ä¸»è¦ç‰¹å¾æœ‰å“ªäº›ï¼Ÿ**
   - è™šæ‹Ÿå­˜å‚¨å™¨çš„ç‰¹å¾åŒ…æ‹¬ï¼šç¨‹åºå¯ä»¥ä¸å®Œå…¨è£…å…¥å†…å­˜å³å¯è¿è¡Œï¼›é€šè¿‡é¡µè¡¨å®ç°è™šæ‹Ÿåœ°å€å’Œç‰©ç†åœ°å€çš„æ˜ å°„ï¼›é€šè¿‡é¡µé¢ç½®æ¢æŠ€æœ¯æé«˜å†…å­˜åˆ©ç”¨ç‡ã€‚



å®ç° **OPTï¼ˆOptimal Page Replacementï¼‰** ç®—æ³•çš„å…³é”®æ˜¯ï¼Œ**é¢„çŸ¥æœªæ¥**ï¼Œæ‰¾åˆ°æœªæ¥æœ€æ™šè¢«è®¿é—®çš„é¡µé¢è¿›è¡Œæ›¿æ¢ã€‚ä¸è¿‡ï¼Œç”±äºæˆ‘ä»¬æ— æ³•é¢„çŸ¥æœªæ¥ï¼Œæ‰€ä»¥åœ¨ç¼–ç¨‹å®ç°ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡åˆ†ææ¥ä¸‹æ¥çš„è®¿é—®åºåˆ—ï¼Œæ¨¡æ‹Ÿå‡ºæœªæ¥é¡µé¢çš„ä½¿ç”¨æƒ…å†µï¼Œä»è€Œå®ç° OPT ç®—æ³•ã€‚

### **OPT ç®—æ³•çš„æ­¥éª¤ï¼š**
1. æ¯æ¬¡éœ€è¦ä¸€ä¸ªæ–°é¡µé¢æ—¶ï¼Œåˆ¤æ–­è¯¥é¡µé¢æ˜¯å¦å·²ç»åœ¨å†…å­˜ä¸­ã€‚
2. å¦‚æœé¡µé¢ä¸åœ¨å†…å­˜ä¸­ï¼Œå¹¶ä¸”å†…å­˜å·²æ»¡ï¼Œåˆ™æ‰¾åˆ°æœªæ¥æœ€ä¹…ä¸å†è¢«è®¿é—®çš„é¡µé¢ï¼Œè¿›è¡Œæ›¿æ¢ã€‚
3. å¦‚æœå†…å­˜æœªæ»¡ï¼Œåˆ™å°†é¡µé¢ç›´æ¥åŠ å…¥å†…å­˜ã€‚
4. è®¡ç®—æ€»çš„ç¼ºé¡µæ¬¡æ•°ã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨ C++ ç¼–å†™çš„ **OPT é¡µé¢ç½®æ¢ç®—æ³•**ï¼š

```cpp
#include <iostream>
#include <vector>
#include <algorithm>
#include <climits>

using namespace std;

// æ‰¾åˆ°éœ€è¦è¢«æ›¿æ¢çš„é¡µé¢ï¼Œè¿”å›å®ƒåœ¨å†…å­˜ä¸­çš„ä½ç½®
int findPageToReplace(vector<int> &pages, vector<int> &frames, int index) {
    int farthest = index; // ç”¨äºè®°å½•æœ€è¿œè¢«ä½¿ç”¨çš„é¡µé¢çš„ç´¢å¼•
    int replaceIndex = -1; // éœ€è¦è¢«æ›¿æ¢çš„é¡µé¢çš„å†…å­˜ä½ç½®

    // éå†å†…å­˜ä¸­çš„é¡µé¢
    for (int i = 0; i < frames.size(); i++) {
        int j;
        // æŸ¥æ‰¾å½“å‰é¡µé¢åœ¨æœªæ¥çš„ç¬¬ä¸€æ¬¡å‡ºç°
        for (j = index; j < pages.size(); j++) {
            if (frames[i] == pages[j]) {
                if (j > farthest) {
                    farthest = j; // æ‰¾åˆ°ç¦»å½“å‰æœ€è¿œçš„é¡µé¢
                    replaceIndex = i;
                }
                break;
            }
        }

        // å¦‚æœé¡µé¢åœ¨æœªæ¥ä¸ä¼šå†è¢«è®¿é—®ï¼Œåˆ™ç›´æ¥æ›¿æ¢
        if (j == pages.size()) {
            return i;
        }
    }

    // å¦‚æœæ‰€æœ‰é¡µé¢éƒ½ä¼šå†æ¬¡è¢«è®¿é—®ï¼Œè¿”å›æœ€è¿œçš„é‚£ä¸ªé¡µé¢
    return replaceIndex == -1 ? 0 : replaceIndex;
}

// å®ç°OPTé¡µé¢ç½®æ¢ç®—æ³•
void OPTPageReplacement(int pages[], int n, int capacity) {
    vector<int> frames; // å­˜æ”¾å†…å­˜ä¸­çš„é¡µé¢
    int pageFaults = 0; // è®°å½•ç¼ºé¡µæ¬¡æ•°

    for (int i = 0; i < n; i++) {
        // å¦‚æœé¡µé¢å·²ç»åœ¨å†…å­˜ä¸­ï¼Œè·³è¿‡
        if (find(frames.begin(), frames.end(), pages[i]) != frames.end()) {
            cout << "é¡µé¢ " << pages[i] << " å·²åœ¨å†…å­˜ä¸­ï¼Œå½“å‰å†…å­˜ï¼š";
            for (auto page : frames) cout << page << " ";
            cout << endl;
            continue;
        }

        // å¦‚æœå†…å­˜å·²æ»¡ï¼Œä½¿ç”¨ OPT ç®—æ³•é€‰æ‹©è¦æ›¿æ¢çš„é¡µé¢
        if (frames.size() == capacity) {
            int indexToReplace = findPageToReplace(pages, frames, i + 1);
            frames[indexToReplace] = pages[i]; // æ›¿æ¢é¡µé¢
        } else {
            frames.push_back(pages[i]); // å†…å­˜æœªæ»¡æ—¶ç›´æ¥æ·»åŠ é¡µé¢
        }

        pageFaults++; // å¢åŠ ç¼ºé¡µæ¬¡æ•°
        cout << "é¡µé¢ " << pages[i] << " ä¸åœ¨å†…å­˜ä¸­ï¼Œå½“å‰å†…å­˜ï¼š";
        for (auto page : frames) cout << page << " ";
        cout << endl;
    }

    cout << "æ€»ç¼ºé¡µæ¬¡æ•°ï¼š" << pageFaults << endl;
}

int main() {
    int pages[] = {1, 2, 3, 4, 2, 1, 5, 6, 2, 1, 2, 3, 7}; // é¡µé¢åºåˆ—
    int n = sizeof(pages) / sizeof(pages[0]);
    int capacity = 3; // å†…å­˜å®¹é‡ä¸º 3

    OPTPageReplacement(pages, n, capacity);

    return 0;
}
```

### **ä»£ç è§£é‡Šï¼š**
1. **`findPageToReplace` å‡½æ•°ï¼š** å®ƒé€šè¿‡éå†å†…å­˜ä¸­çš„é¡µé¢ï¼Œæ‰¾åˆ°æœªæ¥æœ€è¿œä¸ä¼šè¢«è®¿é—®çš„é¡µé¢ï¼Œå¹¶è¿”å›è¯¥é¡µé¢çš„ç´¢å¼•ã€‚å¦‚æœæŸä¸ªé¡µé¢åœ¨æœªæ¥ä¸ä¼šè¢«è®¿é—®ï¼Œåˆ™ç›´æ¥è¿”å›è¯¥é¡µé¢çš„ä½ç½®ï¼Œä½œä¸ºæ›¿æ¢å¯¹è±¡ã€‚
2. **`OPTPageReplacement` å‡½æ•°ï¼š**
   - éå†é¡µé¢è®¿é—®åºåˆ—ï¼š
     - å¦‚æœé¡µé¢å·²ç»åœ¨å†…å­˜ä¸­ï¼Œè·³è¿‡æœ¬æ¬¡æ“ä½œã€‚
     - å¦‚æœå†…å­˜å·²æ»¡ï¼Œåˆ™è°ƒç”¨ `findPageToReplace` æ¥æ‰¾åˆ°éœ€è¦æ›¿æ¢çš„é¡µé¢ã€‚
     - å¦‚æœå†…å­˜æœªæ»¡ï¼Œç›´æ¥å°†é¡µé¢åŠ å…¥å†…å­˜ã€‚
   - è®°å½•å¹¶è¾“å‡ºç¼ºé¡µæ¬¡æ•°ã€‚
3. **é¡µé¢åºåˆ—ï¼š** å®šä¹‰äº†ä¸€ä¸ªé¡µé¢è®¿é—®åºåˆ— `pages[]`ï¼Œå†…å­˜å®¹é‡è®¾ç½®ä¸º `capacity = 3`ã€‚

### **è¾“å‡ºç¤ºä¾‹ï¼š**

```plaintext
é¡µé¢ 1 ä¸åœ¨å†…å­˜ä¸­ï¼Œå½“å‰å†…å­˜ï¼š1 
é¡µé¢ 2 ä¸åœ¨å†…å­˜ä¸­ï¼Œå½“å‰å†…å­˜ï¼š1 2 
é¡µé¢ 3 ä¸åœ¨å†…å­˜ä¸­ï¼Œå½“å‰å†…å­˜ï¼š1 2 3 
é¡µé¢ 4 ä¸åœ¨å†…å­˜ä¸­ï¼Œå½“å‰å†…å­˜ï¼š4 2 3 
é¡µé¢ 2 å·²åœ¨å†…å­˜ä¸­ï¼Œå½“å‰å†…å­˜ï¼š4 2 3 
é¡µé¢ 1 ä¸åœ¨å†…å­˜ä¸­ï¼Œå½“å‰å†…å­˜ï¼š1 2 3 
é¡µé¢ 5 ä¸åœ¨å†…å­˜ä¸­ï¼Œå½“å‰å†…å­˜ï¼š1 2 5 
é¡µé¢ 6 ä¸åœ¨å†…å­˜ä¸­ï¼Œå½“å‰å†…å­˜ï¼š1 6 5 
é¡µé¢ 2 ä¸åœ¨å†…å­˜ä¸­ï¼Œå½“å‰å†…å­˜ï¼š2 6 5 
é¡µé¢ 1 ä¸åœ¨å†…å­˜ä¸­ï¼Œå½“å‰å†…å­˜ï¼š2 6 1 
é¡µé¢ 2 å·²åœ¨å†…å­˜ä¸­ï¼Œå½“å‰å†…å­˜ï¼š2 6 1 
é¡µé¢ 3 ä¸åœ¨å†…å­˜ä¸­ï¼Œå½“å‰å†…å­˜ï¼š2 3 1 
é¡µé¢ 7 ä¸åœ¨å†…å­˜ä¸­ï¼Œå½“å‰å†…å­˜ï¼š2 3 7 
æ€»ç¼ºé¡µæ¬¡æ•°ï¼š10
```

### **æ€»ç»“ï¼š**
- è¯¥å®ç°çš„æ ¸å¿ƒåœ¨äºæ‰¾åˆ°æœ€è¿œä¸ä¼šå†ç”¨çš„é¡µé¢è¿›è¡Œæ›¿æ¢ï¼Œä»¥æ­¤å‡å°‘æœªæ¥çš„ç¼ºé¡µæ¬¡æ•°ã€‚
- **OPT** ç®—æ³•å¯ä»¥ä¿è¯ç†è®ºä¸Šçš„æœ€å°‘ç¼ºé¡µï¼Œä½†ç”±äºæˆ‘ä»¬æ— æ³•é¢„çŸ¥æœªæ¥ï¼Œå®é™…åº”ç”¨ä¸­è¿™ç§ç®—æ³•å¹¶ä¸å®ç”¨ï¼Œæ›´å¤šæ˜¯ä½œä¸ºä¸€ç§æ€§èƒ½å‚è€ƒæ ‡å‡†ã€‚

å¦‚æœä½ æœ‰å…¶ä»–é—®é¢˜ï¼Œéšæ—¶é—®æˆ‘ï¼